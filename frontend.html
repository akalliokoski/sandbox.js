<head><title>FHIRcast JavaScript Playground</title></head>
<script>
    function sendEvent(contextData,destinationURI){
        var xhr=new XMLHttpRequest();
  //      xhr.open('POST','http://localhost:6001/notify',true);
        xhr.open('POST',destinationURI,true);
        xhr.setRequestHeader('Content-Type','application/json');
        xhr.send(contextData);
        xhr.onloadend = function() {        };
        console.log('event sent from browser'+ JSON.stringify(contextData));
    }
    
        var ws = new WebSocket('ws://localhost:6001/log');
        // event emmited when connected
        ws.onopen = function () {
            console.log('websocket is connected ...')
            // sending a send event to websocket server
            ws.send('connected')
        }
        // event emmited when receiving message 
        ws.onmessage = function (ev) {
            document.getElementById('incomingMsgOutput').value=ev.data;
            console.log(ev.data);
        }
</script>
<body style="background-color:lightgray;">
<h2>FHIRcast JavaScript Playground</h2>
<table border="1">
<tr colspan="2"></trcolspan>hub URI: <input id="hubSubscribeURI" size="30" value="http://localhost:6001/api/hub/"></input></tr>
<tr><td>
    <form action="http://localhost:6001/api/hub/" method="POST">
    <table>
        <th colspan="2">Subscribe to an event</th>  
        <tr><td>hub.callback: </td><td><input name="hub.callback" size="29" type="url" value="http://localhost:6001/client"></input></td></tr>          
        <tr><td>hub.mode:</td><td><select name="hub.mode">
                        <option value="subscribe" selected >subscribe</option>
                        <option value="unsubscribe" >unsubscribe</option>
                    </select></td></tr>
        <tr><td>hub.events:</td><td><select name="hub.events">
                        <option value="open-patient-chart" selected >open-patient-chart</option>
                        <option value="switch-patient-chart">switch-patient-chart</option>
                        <option value="close-patient-chart">close-patient-chart</option>
                        <option value="open-imaging-study">open-imaging-study</option>
                        <option value="switch-imaging-study">switch-imaging-study</option>
                        <option value="close-imaging-study">close-imaging-study</option>
                        <option value="user-logout">user-logout</option>
                        <option value="user-hibernate">user-hibernate</option>
                    </select> </td></tr>
        <tr><td>hub.secret: </td><td><input name="hub.secret" type="text" value="secret"></input></td></tr>          
        <tr><td>hub.topic: </td><td><input name="hub.topic" type="text" value="FHIRcast testing"></input></td></tr>
        <tr><td>hub.lease: </td><td><input name="hub.lease" type="text" value="999"></input></td></tr>
        <tr><td><input type="submit"></td></tr>
    </table>
</form>
</td>
<td>
<table>
    <th>Send an event to the hub</th>  
        <tr><td>hub.topic:<input id="hubNotifyURI" size="25" value="http://localhost:6001/notify"></input></td></tr>
        <tr><td>context:</td></tr>
        <tr><td><textarea id="context" rows="10" cols="40">{
"timestamp": "2018-06-13T01:56:11.8281368Z", 
"id": "0c3b67ab5344428c840c4a745dbdf523", 
"event": {
    "hub.topic": "5000-4", 
    "hub.event": "open-patient-chart", 
    "context": "patient123"
    }
}</textarea></td></tr>
        <tr><td><button onclick="sendEvent(document.getElementById('context').value,document.getElementById('hubNotifyURI').value)">Send</button></td></tr>
</table>
</td>
<tr colspan="2">  
    <table>
        <th>Monitor endpoints logs with websocket</th>
        <tr><td><textarea id="incomingMsgOutput" rows="10" cols="80" disabled="disabled"></textarea></td></tr>
    </table>
</tr>
</table>    
</body>
